---
title: "Lighthouse"

categories: [TIL]
comments: true

toc: true
toc_sticky: true

date: 2022-12-05
---

## Lighthouse

**Lighthouse** 는 구글에서 개발한 오픈소스로서 웹 페이지의 품질을 개선할 수 있는 자동화 툴입니다. Lighthouse는 **Performance(성능), Accessibility(접근성), PWA, SEO** 등을 검사하며 이를 이용해 사용자는 어떤 웹페이지든 품질 검사를 할 수 있습니다.

<br/>

1. Performance 항목에서는 웹 성능을 측정합니다. 화면에 콘텐츠가 표시되는데 시간이 얼마나 걸리는지, 표시된 후 사용자와 상호작용하기 까진 얼마나 걸리는지, 화면에 불안정한 요소는 없는지 등을 확인합니다.

2. Accessibility 항목에서는 웹 페이지가 웹 접근성을 잘 갖추고 있는지 확인합니다. 대체 텍스트를 잘 작성했는지, 배경색과 콘텐츠 색상의 대비가 충분한지, 적절한 WAI-ARIA 속성을 사용했는지 등을 확인합니다.

3. Best Practices 항목에서는 웹 페이지가 웹 표준 모범 사례를 잘 따르고 있는지 확인합니다. HTTPS 프로토콜을 사용하는지, 사용자가 확인할 확률은 높지 않지만 콘솔 창에 오류가 표시 되지는 않는지 등을 확인합니다.

4. SEO 항목에서는 웹 페이지가 검색 엔진 최적화가 잘 되어있는지 확인합니다. 애플리케이션의 robots.txt가 유효한지, `<meta>` 요소는 잘 작성되어 있는지, 텍스트 크기가 읽기에 무리가 없는지 등을 확인합니다.

5. PWA 항목에서는 해당 웹 사이트가 모바일 애플리케이션으로서도 잘 작동하는지 확인합니다. 앱 아이콘을 제공하는지, 스플래시 화면이 있는지, 화면 크기에 맞게 콘텐츠를 적절하게 배치했는지 등을 점수가 아닌 체크리스트로 확인합니다.

<h3> Lighthouse의 Performance 측정 메트릭 </h3>

![스크린샷 2022-12-05 14-43-17](https://user-images.githubusercontent.com/111376707/205558252-9394e1f4-48b4-4e07-9922-6944c25a5d2b.png)

1. First Contentful Paint, 줄여서 FCP는 성능(Performance) 지표를 추적하는 메트릭입니다. FCP는 사용자가 페이지에 접속했을 때 브라우저가 DOM 컨텐츠의 첫 번째 부분을 렌더링하는 데 걸리는 시간을 측정합니다. 우수한 사용자 경험을 제공하려면 FCP가 1.8초 이하여야 합니다.

2. Largest Contentful Paint, 줄여서 LCP는 뷰포트를 차지하는 가장 큰 콘텐츠(이미지 또는 텍스트 블록)의 렌더 시간을 측정합니다. 이를 이용해 주요 콘텐츠가 유저에게 보이는 시간까지를 가늠할 수 있습니다.

3. Speed Index는 성능(Performance) 지표를 추적하는 메트릭입니다. Speed Index는 페이지를 로드하는 동안 얼마나 빨리 컨텐츠가 시각적으로 표시되는 지를 측정합니다.

4. Time to interactive, 줄여서 TTI는 페이지가 로드되는 시점부터 사용자와의 상호작용이 가능한 시점까지의 시간을 측정합니다. TTI는 페이지가 완전히 상호 작용 가능하기까지의 시간을 측정합니다.

5. Total Blocking Time, 줄여서 TBT는 페이지가 유저와 상호작용하기까지의 막혀있는 시간을 측정합니다. Lighthouse에서는 FCP와 TTI 사이에 긴 시간이 걸리는 작업들을 모두 기록하여 TBT를 측정합니다.

6. Cumulative Layout Shift, 줄여서 CLS는 사용자에게 컨텐츠가 화면에서 얼마나 많이 움직이는지(불안정한 지)를 수치화한 지표입니다. 이 지표를 통해 화면에서 이리저리 움직이는 요소(불안정한 요소)가 있는 지를 측정할 수 있습니다.

<br/>

<h3>개선 방향 잡기</h3>

![스크린샷 2022-12-05 14-17-46](https://user-images.githubusercontent.com/111376707/205558063-2c5275fe-9084-4c51-8095-efc860279960.png)

Opportunities 항목을 확인하면 각 메트릭별 문제를 확인할 수 있습니다.

<h4>- Serve images in next-gen formats</h4>

<br/>

Next Generation의 줄임말인 next-gen 이미지 형식은 압축 시 원본 이미지의 품질을 유지하는 웹에 최적화된 이미지 파일 형식입니다. 또한 네트워크 데이터를 덜 소비하는 이미지 형식을 제공하므로 로드 시간이 더 빨라집니다.
<br/>

Next-gen 이미지 형식에는 두가지 유형이 있습니다.

- AVIF(AV1 Image File Format) : AVIF는 WebP를 훨씬 능가하는 무손실 이미지 압축 기능으로 설계되었습니다. 그러나 AVIF의 한 가지 주요 단점은 대부분의 브라우저와의 제한된 호환성입니다.

- WebP (Web Picture Format) : WebP는 웹 이미지에 대한 손실 및 무손실 압축을 제공하는 Google에서 개발한 이미지 파일 형식입니다. 이미지 품질을 유지하면서 이미지를 더 작은 크기로 압축하는 이미지 파일 형식입니다.
  <br/>

WebP 및 AVIF와 같은 차세대 형식으로 이미지를 쉽게 변환할 수 있습니다. 이미지를 제공하는 것은 다른 이야기입니다.
<br/>

New-gen 형식으로 이미지를 제공하는 방법

 <br/>

1.HTML5 `<picture>` 요소 사용

WebP 이미지를 제공하는 또 다른 좋은 방법은 사용자의 브라우저에 의존하여 표시할 최상의 이미지 형식을 선택하는 것입니다. 이 방법의 장점 중 하나는 WebP와 호환되지 않는 브라우저에서 다른 이미지 형식을 선택할 수 있는 내장 이미지 백업입니다.

  <br/>

```html
<picture>
  <source srcset="logo.webp" type="image/webp" />
  <img src="logo.png" alt="logo" />
</picture>
```

  <br/>

2.자바스크립트 활용

Javascript는 WebP 이미지 형식과 호환되는 브라우저를 감지하는 Modernizr라는 라이브러리를 이용할 수 있습니다. 해당 라이브러리는 사용자의 브라우저가 제공해야 하는 기본 CSS3 및 HTML5 기능을 테스트하는 데 도움이 됩니다.

<br/>

<h4> - Properly size images</h4>

 <br/>

이미지 크기를 적절하게 조정하는 방법

1.srcset 사용

도메인에서 반응형 이미지 사용 srcset을 쉽게 구현하고 자동화하는 데 사용할 수 있습니다. 기본적으로 다양한 크기의 이미지를 만든 다음 srcset태그를 활용하여 이미지가 제공되는 시기를 정의합니다. 이는 여러 장치 및 크기에 걸쳐 전달할 여러 이미지가 있는 경우 반응형 디자인에 유용합니다.

예를 들어 장치 픽셀 비율(DPR) 에 따라 고해상도 화면을 사용하는 사용자에게만 고해상도 이미지를 보내려고 한다고 가정해 보겠습니다 .

```html
<img
  srcset="large.jpg 3x, small.jpg 2x"
  src=" small.jpg "
  alt=" 단일 이미지 "
/>
```

- 방문자에게 DPR이 2인 large.jpg를 제공합니다.
- DPR이 1인 방문자에게 small.jpg를 제공합니다.
- 브라우저에서 지원되지 않는 경우 srcset브라우저는 기본적으로 small.jpg로 설정됩니다.

 <br/>

2.CDN

CDN은 이미지 변환, 최적화 및 전달을 전문으로 하는 서비스입니다.
이미지 CDN은 다음과 같은 방식으로 이미지를 처리할 수 있습니다.

- 파일 크기를 줄이기 위한 이미지 압축.
- 이미지를 적절한 디스플레이로 크기 조정, 자르기 및 자르기.
- 이미지를 보다 최적의 형식(예: WebP)으로 변환합니다.
- 대기 시간 개선을 위해 글로벌 CDN을 통해 이미지를 제공합니다.

 <br/>

<h4> - Use HTTP/2</h4>
 
 HTTP/2는 더 많은 병렬 요청을 처리하기 위한 더 높은 연결 제한과 더 낮은 프로토콜 오버헤드를 포함하여 HTTP/1.1에서 볼 수 있는 많은 제한을 극복합니다.

대부분의 브라우저가 HTTP/2를 지원합니다.

![스크린샷 2022-12-05 15-38-45](https://user-images.githubusercontent.com/111376707/205565979-403af70f-be60-41fd-b0c9-91df8d499f9c.png)

출처 : https://caniuse.com/http2

<br/>

그러나 국내 대부분의 서버는 현재 HTTP/1.x를 사용하고 있기 때문에 서버가 HTTP/2 통신을 지원하는 지를 확인 한 후 HTTP/2를 사용해야 합니다.

<br/>

<h4> - Reduce unused JavaScript</h4>

<br/>

사용하지 않는 JavaScript는 브라우저 실행 시간을 불필요하게 늘려 페이지 로드 속도를 늦춥니다.  
 페이지를 로드하는 동안 실행되지 않는 코드에 대해 JavaScript 파일을 확인하여, 사용되지 않은 코드가 20KB 이상인 JavaScript 파일이 표시됩니다.

1.  코드 분할

    번들된 JavaScript를 중요한 JavaScript와 중요하지 않은 JavaScript로 분리. 중요한 JavaScript만 먼저 로드되므로 렌더링 차단 동작을 줄일 수 있으며, 그런 다음 페이지에 필요하지 않은 중요하지 않은 JavaScript를 제거 가능

2.  사용하지 않는 코드 제거

3.  사용하지 않은 import 코드 제거
